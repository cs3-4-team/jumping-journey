var N=Object.defineProperty;var Y=(o,e,t)=>e in o?N(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>Y(o,typeof e!="symbol"?e+"":e,t);import{d as G,r as O,o as P,c as E,a as f,t as j,b as J,w as U,e as Q,_ as $,f as x,g as Z,h as tt,i as et,j as st,k as it,l as q,u as at,m as nt,T as ht}from"./index-Bed00VbX.js";class z{constructor(e){a(this,"canvas");a(this,"context");this.canvas=document.getElementById(e),this.context=this.canvas.getContext("2d"),this.resizeCanvas()}clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}setFillColor(e){this.context.fillStyle=e}setStrokeColor(e){this.context.strokeStyle=e}setLineWidth(e){this.context.lineWidth=e}drawRectangle(e,t,i,s){this.context.fillRect(e,t,i,s)}drawCircle(e,t,i){this.context.beginPath(),this.context.arc(e,t,i,0,Math.PI*2),this.context.fill(),this.context.closePath()}drawLine(e,t,i,s){this.context.beginPath(),this.context.moveTo(e,t),this.context.lineTo(i,s),this.context.stroke(),this.context.closePath()}drawText(e,t,i,s="16px Arial",h="black"){this.context.font=s,this.context.fillStyle=h,this.context.fillText(e,t,i)}drawImage(e,t,i,s,h){if(typeof e=="string"){const l=new Image;l.src=e,l.onload=()=>{this.context.drawImage(l,t,i,s,h)}}else this.context.drawImage(e,t,i,s,h)}saveState(){this.context.save()}restoreState(){this.context.restore()}rotateCanvas(e){this.context.rotate(e)}translateCanvas(e,t){this.context.translate(e,t)}scaleCanvas(e,t){this.context.scale(e,t)}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}getContext(){return this.context}}const ot="/sprites";class L{constructor(e,t,i,s,h){a(this,"type");a(this,"isPermeability");a(this,"imagesSrc",ot);a(this,"color");a(this,"x");a(this,"y");this.type=e,this.isPermeability=t,this.x=i,this.y=s,this.color=h}getType(){return this.type}isCellPermeabilty(){return this.isPermeability}getPosition(){return{x:this.x,y:this.y}}}const rt="ground/ground.jpg";class ct extends L{constructor(t,i,s,h,c){super("ground",!0,t,i,"green");a(this,"width");a(this,"height");a(this,"canvasHelper");this.width=s,this.height=h,this.canvasHelper=c}draw(){this.canvasHelper.drawImage(`${this.imagesSrc}/${rt}`,this.x,this.y,this.width,this.height)}}const lt="lava/lava.jpg";class dt extends L{constructor(t,i,s,h,c){super("Lava",!1,t,i,"orange");a(this,"width");a(this,"height");a(this,"canvasHelper");this.width=s,this.height=h,this.canvasHelper=c}draw(){this.canvasHelper.drawImage(`${this.imagesSrc}/${lt}`,this.x,this.y,this.width,this.height)}}const ut="platform/platform.jpg";class mt extends L{constructor(t,i,s,h,c){super("platform",!0,t,i,"gray");a(this,"width");a(this,"height");a(this,"canvasHelper");this.width=s,this.height=h,this.canvasHelper=c}draw(){this.canvasHelper.drawImage(`${this.imagesSrc}/${ut}`,this.x,this.y,this.width,this.height)}interact(){}}const A=["coin/coin1.png","coin/coin2.png","coin/coin3.png","coin/coin4.png","coin/coin5.png","coin/coin6.png"];class pt extends L{constructor(t,i,s,h,c){super("coin",!1,t,i,"gold");a(this,"width");a(this,"height");a(this,"canvasHelper");a(this,"coinImages",[]);a(this,"frameRate",200);a(this,"currentFrame",0);a(this,"lastFrameTime",0);a(this,"requestAnimationId",0);this.width=s,this.height=h,this.canvasHelper=c}startAnimation(){this.requestAnimationId=requestAnimationFrame(this.animate.bind(this))}animate(t){if(t-this.lastFrameTime>=this.frameRate){const i=A.length;this.canvasHelper.getContext().clearRect(this.x,this.y,this.width,this.height),this.canvasHelper.drawImage(this.coinImages[this.currentFrame],this.x,this.y,this.width,this.height),this.currentFrame=(this.currentFrame+1)%i,this.lastFrameTime=t}this.requestAnimationId=requestAnimationFrame(this.animate.bind(this))}draw(){const t=A.length;A.forEach((i,s)=>{const h=new Image;h.src=`${this.imagesSrc}/${i}`,h.onload=()=>{this.coinImages[s]=h,this.coinImages.length===t&&this.startAnimation()}})}stopAnimation(){this.requestAnimationId&&cancelAnimationFrame(this.requestAnimationId)}}const vt=["..........................C....","..........................P....","....................P..........","....................L........PP","...............................",".........................PPPL..","...................PPP.........",".............PPPL..............",".......PPPL..............PP....","...............................","GGGGGGGGGGGLLLLGGGGLLLGGGGGGGGG"],gt=["...................LLL.LLL.LLL.","...................L...L.....L.","...................L...LLL.LLL.","...................L.....L...L.","...................LLL.LLL.LLL.","...........................PPP.","...................C..PPPLL....",".................PPPLL.........","..........PPPPPPP..............",".......PPPPPPPPPPPPP...........","....PPPPPPPPPPPPPPPPPPPP.......","GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG"],W=[vt,gt],ft=50;class yt{constructor(e,t){a(this,"canvasHelper");a(this,"tileSize",ft);a(this,"mapData");a(this,"lavas",[]);a(this,"platforms",[]);a(this,"coins",[]);this.canvasHelper=e,this.mapData=this.normalizeeSchema(t)}normalizeeSchema(e){if(!e.length)return[];let t=[...e];const i=this.canvasHelper.getHeight(),s=this.canvasHelper.getWidth(),h=Math.ceil(s/this.tileSize),c=Math.floor(i/this.tileSize);for(let n=0;n<t.length;n++)if(t[n].length<h){const d=h-t[n].length,m=n===t.length-1?"G".repeat(d):".".repeat(d);t[n]+=m}else t[n].length>h&&(t[n]=t[n].slice(0,h-1));const l=c-e.length;if(l>0){const n=".".repeat(h);t=[...new Array(l).fill(n),...t]}return t}generateMap(){this.mapData.forEach((e,t)=>{[...e].forEach((i,s)=>{const h=s*this.tileSize,c=t*this.tileSize;this.drawTile(i,h,c)})})}stopAnimation(){this.coins.forEach(e=>e.stopAnimation())}calculateTileSize(){const e=window.innerWidth,t=window.innerHeight,i=this.mapData[0].length,s=this.mapData.length,h=e/i,c=t/s;return Math.max(h,c)}drawTile(e,t,i){switch(e){case"G":{const s=new ct(t,i+this.tileSize,this.tileSize,this.tileSize,this.canvasHelper);this.platforms.push(s),s.draw();break}case"L":{const s=new dt(t,i+this.tileSize,this.tileSize,this.tileSize,this.canvasHelper);this.lavas.push(s),s.draw();break}case"P":{const s=new mt(t,i+this.tileSize,this.tileSize,this.tileSize,this.canvasHelper);this.platforms.push(s),s.draw();break}case"C":{const s=new pt(t,i+this.tileSize,this.tileSize,this.tileSize,this.canvasHelper);this.coins.push(s),s.draw();break}}}}class wt{constructor(e=0,t=0){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}multiply(e){this.x*=e,this.y*=e}set(e,t){this.x=e,this.y=t}}var g=(o=>(o.IDLE="idle",o.WALK_1="go1",o.WALK_2="go2",o.WALK_3="go3",o.WALK_4="go4",o.WALK_5="go5",o.JUMP_1="jump1",o.JUMP_2="jump2",o.JUMP_3="jump3",o.JUMP_4="jump4",o.JUMP_5="jump5",o.DEAD_1="dead1",o.DEAD_2="dead2",o.DEAD_3="dead3",o.DEAD_4="dead4",o))(g||{});class xt{constructor(e,t,i,s,h){a(this,"width",64);a(this,"height",64);a(this,"state",g.IDLE);a(this,"sprites",{});a(this,"deathFrame",0);a(this,"deathAnimationSpeed",150);a(this,"lastDeathFrameUpdate",0);a(this,"isDeathAnimationComplete",!1);a(this,"lastAnimationUpdate",0);a(this,"walkAnimationSpeed",150);a(this,"currentWalkFrame",1);a(this,"direction",1);a(this,"jumpFrame",1);a(this,"jumpAnimationSpeed",100);a(this,"lastJumpFrameUpdate",0);a(this,"velocity");a(this,"gravity");a(this,"bounce");a(this,"isJumping");a(this,"onPlatform");a(this,"friction");a(this,"isDead_",!1);a(this,"savedArea",null);this.canvasHelper=e,this.x=t,this.y=i,this.radius=s,this.gameKeys=h,this.velocity=new wt,this.gravity=.31,this.bounce=-.5,this.isJumping=!1,this.isDead_=!1,this.onPlatform=!1,this.friction=.93,this.loadSprites()}isDeathAnimationFinished(){return this.isDeathAnimationComplete}async loadSprites(){const e=Object.values(g);for(const t of e){const i=new Image;i.src=`/sprites/player/${t}.png`,await new Promise(s=>{i.onload=s}),this.sprites[t]=i}}drawDebugInfo(){const e=this.canvasHelper.getContext();e.strokeStyle="rgba(0,255,0,0.5)",e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.stroke(),e.fillStyle="blue",e.font="12px Arial",e.fillText(`x:${Math.round(this.x)},y:${Math.round(this.y)}`,this.x-30,this.y-20)}draw(){const e=this.sprites[this.state];if(this.isDead_&&!this.isDeathAnimationComplete){const t=performance.now();if(t-this.lastDeathFrameUpdate>this.deathAnimationSpeed)if(this.deathFrame++,this.lastDeathFrameUpdate=t,this.deathFrame<=4){const i=`DEAD_${this.deathFrame}`;this.state=g[i]}else this.isDeathAnimationComplete=!0}else if(!this.isDead_)if(Math.abs(this.velocity.x)>0&&this.onPlatform){const t=performance.now();if(t-this.lastAnimationUpdate>this.walkAnimationSpeed){this.currentWalkFrame=this.currentWalkFrame%5+1;const i=`WALK_${this.currentWalkFrame}`;this.state=g[i],this.lastAnimationUpdate=t,this.direction=this.velocity.x>0?1:-1}}else if(this.isJumping||this.velocity.y>2){const t=performance.now();if(t-this.lastJumpFrameUpdate>this.jumpAnimationSpeed){this.velocity.y<0&&this.jumpFrame<3?this.jumpFrame++:this.velocity.y>-2&&this.velocity.y<2&&this.jumpFrame<4?this.jumpFrame=3:this.velocity.y>2&&this.jumpFrame<5?this.jumpFrame=4:this.velocity.y>5&&(this.jumpFrame=5);const i=`JUMP_${this.jumpFrame}`;this.state=g[i],this.lastJumpFrameUpdate=t}}else this.state=g.IDLE;e&&(this.canvasHelper.clearCanvas(),this.canvasHelper.saveState(),this.canvasHelper.translateCanvas(this.x-this.width/2,this.y-this.height/2),this.direction===-1?(this.canvasHelper.scaleCanvas(-1,1),this.canvasHelper.translateCanvas(-this.width,0)):this.canvasHelper.scaleCanvas(1,1),this.canvasHelper.drawImage(e,0,0,this.width,this.height),this.canvasHelper.restoreState())}resetPosition(){this.x=100,this.y=this.canvasHelper.getHeight()-200,this.velocity.x=0,this.velocity.y=0,this.isJumping=!1,this.onPlatform=!1,this.isDead_=!1,this.deathFrame=0,this.isDeathAnimationComplete=!1,this.state=g.IDLE}checkPlatformCollisions(e){e.forEach(t=>{this.y+this.radius>t.y&&this.y-this.radius<t.y+t.height&&this.x+this.radius>t.x&&this.x-this.radius<t.x+t.width&&this.y-this.radius<=t.y&&(this.y=t.y-this.radius,this.velocity.y=0,this.isJumping=!1,this.onPlatform=!0)})}checkCoinCollisions(e){for(const t of e){const i=this.x-(t.x+t.width/2),s=this.y-(t.y+t.height/2);if(i*i+s*s<=this.radius*this.radius)return!0}return!1}update(e,t,i,s){for(const n of t){const d=Math.max(n.getPosition().x,Math.min(this.x,n.getPosition().x+n.width)),m=Math.max(n.getPosition().y,Math.min(this.y,n.getPosition().y+n.height)),v=this.x-d,p=this.y-m;if(v*v+p*p<=this.radius*this.radius){this.isDead_=!0;return}}if(this.checkCoinCollisions(i))return!0;const h=s/20;this.velocity.y+=this.gravity*h/1.2;const c=this.x,l=this.y;if(this.x+=this.velocity.x*h,this.y+=this.velocity.y*h,this.onPlatform=!1,e.forEach(n=>{if(this.y+this.radius>n.y&&this.y-this.radius<n.y+n.height&&this.x+this.radius>n.x&&this.x-this.radius<n.x+n.width){const d=c+this.radius<=n.x,m=c-this.radius>=n.x+n.width,v=l+this.radius<=n.y,p=l-this.radius>=n.y+n.height;v&&this.velocity.y>0?(this.y=n.y-this.radius,this.velocity.y=0,this.isJumping=!1,this.onPlatform=!0):p&&this.velocity.y<0?(this.y=n.y+n.height+this.radius,this.velocity.y=0):d&&this.velocity.x>0?(this.x=n.x-this.radius,this.velocity.x=0):m&&this.velocity.x<0&&(this.x=n.x+n.width+this.radius,this.velocity.x=0)}}),this.y+this.radius>this.canvasHelper.getHeight()&&(this.y=this.canvasHelper.getHeight()-this.radius,this.velocity.y*=this.bounce,this.isJumping=!1,this.onPlatform=!0),this.x+this.radius>this.canvasHelper.getWidth()?(this.velocity.x=-this.velocity.x,this.x=this.canvasHelper.getWidth()-this.radius):this.x-this.radius<0&&(this.velocity.x=-this.velocity.x,this.x=this.radius),!this.isJumping&&this.onPlatform&&!this.gameKeys.ArrowLeft&&!this.gameKeys.ArrowRight){const n=Math.sign(this.velocity.x),d=Math.abs(this.velocity.x);if(d>0){const m=Math.max(0,d-.4);this.velocity.x=n*m}}}jump(){this.onPlatform&&(this.velocity.y=-8,this.isJumping=!0,this.jumpFrame=1)}setVelocityX(e){this.velocity.x=e,e!==0&&(this.direction=e>0?1:-1)}getVelocityX(){return this.velocity.x}getIsJumping(){return this.isJumping}isDead(){return this.isDead_}}const Pt={class:"restartScreen"},Lt={class:"restartScreen__content"},_t={class:"restartScreen__title"},At={class:"restartScreen__button-container"},Gt=G({__name:"PauseWindow",props:{data:{}},setup(o){return(e,t)=>{const i=O("RouterLink");return P(),E("div",Pt,[t[2]||(t[2]=f("div",{class:"restartScreen__background"},null,-1)),f("div",Lt,[f("h2",_t,j(e.data.msg),1),f("div",At,[J(i,{class:"restartScreen__button",to:"/"},{default:U(()=>t[1]||(t[1]=[Q("🏃‍♂️Back to menu")])),_:1}),f("a",{class:"restartScreen__button",onClick:t[0]||(t[0]=(...s)=>e.data.handler&&e.data.handler(...s))},"🎮"+j(e.data.btnText),1)])])])}}}),Ct=$(Gt,[["__scopeId","data-v-08ee5724"]]),St={class:"gameContainer"},Ht=G({__name:"TheGame",setup(o){const e=x(!1),t=x(!1),i=x(!1),s=x(null),h={};let c=null,l,n=0,d,m,v,p=0;const _=Z(()=>e.value||t.value||i.value),R=tt({isPaused:t,isDead:e,isLevelCompleted:i});et(()=>R,r=>{r.isPaused?d={msg:"Pause",handler:C,btnText:"Continue"}:r.isDead?d={msg:"Oooops...",handler:V,btnText:"Try again"}:r.isLevelCompleted&&(d={msg:"Well done, fren👏",handler:B,btnText:"Next level"},p>=W.length-1?p=0:p++)},{deep:!0});function V(){e.value=!1,S()}function C(){t.value=!t.value}function B(){i.value=!1,I(m),S()}function S(){var r,u;(r=s.value)==null||r.resetPosition(),(u=s.value)==null||u.update(l.platforms,l.lavas,l.coins,16.67),n=0,c&&cancelAnimationFrame(c),w(performance.now())}function w(r){var b,T,M;if(n===0){n=r,requestAnimationFrame(w);return}if((b=s.value)!=null&&b.isDead()&&s.value.isDeathAnimationFinished()){e.value=!0;return}const u=r-n;if(n=r,(T=s.value)==null?void 0:T.update(l.platforms,l.lavas,l.coins,u)){i.value=!0;return}(M=s.value)==null||M.draw(),c=requestAnimationFrame(w)}function H(r){var u,y;if(r.key==="Escape"){C();return}_.value||(h[r.code]=!0,h.ArrowUp&&!((u=s.value)!=null&&u.getIsJumping())&&((y=s.value)==null||y.jump(),k()),D())}function F(r){h[r.code]=!1,D()}function D(){var r;(r=s.value)!=null&&r.getIsJumping()||k()}function k(){var r,u,y;h.ArrowLeft?(r=s.value)==null||r.setVelocityX(-5):h.ArrowRight?(u=s.value)==null||u.setVelocityX(5):(y=s.value)==null||y.setVelocityX(0)}function K(){window.addEventListener("keydown",H),window.addEventListener("keyup",F)}function X(){window.removeEventListener("keydown",H),window.removeEventListener("keyup",F)}function I(r){r.clearCanvas(),l&&l.stopAnimation(),l=new yt(r,W[p]),l.generateMap()}return st(()=>{m=new z("sceneCanvas"),v=new z("personCanvas"),s.value=new xt(v,100,v.getHeight()-200,25,h),I(m),K(),w(performance.now())}),it(X),(r,u)=>(P(),E("div",St,[u[0]||(u[0]=f("canvas",{id:"sceneCanvas"},null,-1)),u[1]||(u[1]=f("canvas",{id:"personCanvas"},null,-1)),J(ht,{name:"fade"},{default:U(()=>[_.value?(P(),q(Ct,{key:0,data:at(d)},null,8,["data"])):nt("",!0)]),_:1})]))}}),Ft=$(Ht,[["__scopeId","data-v-d2cae3db"]]),It=G({__name:"GameView",setup(o){return(e,t)=>(P(),q(Ft))}});export{It as default};
